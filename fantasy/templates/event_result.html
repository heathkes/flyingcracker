{% extends "fantasy-series.html" %}
{% load user_time %}

{% block fantasy-main %}
{{ block.super }}
<div class="section-header">
    <div class="section-title">
        {{ event }} - <a href="{{ series.get_absolute_url }}">{{ series }}</a>
    </div>
    {% if event.description %}<div class="section-tagline">{{ event.description }}</div>{% endif %}
</div>

{% if user_guesses %}
<hr />
<div class="fantasy-guess-deadline fantasy-form-help">
{% with user|user_time:guess_timestamp as timestamp %}
submitted {{ timestamp|date:"D F d, Y" }}<br />{{ timestamp|time:"f a" }} {% firstof user.get_profile.timezone event.timezone %}
{% endwith %}</div>
<h2>My Picks</h2>
{% for guess in user_guesses %}
{{ guess.competitor }} ({{ guess.result }})<br />
{% endfor %}
{% endif %}

<hr />
<h2>{{ series.event_label|capfirst }} Result</h2>
{% if event_points_list and not event.result_locked %}(pending Series administrator approval){% endif %}
<div id="result-list-container" class="fantasy-list-container">
{% if result_list %}
    <table id="result-list-table" class="fantasy-list-table">
        <thead>
            <tr>
                <th>Place</th>
                <th>Fantasy<br />Points</th>
                <th>{{ series.competitor_label }}</th>
                <th>Picked By</th>
            </tr>
        </thead>
        <tbody>
{% for r in result_list %}
            <tr>
                <td class="center">{{ r.result }}</td>
                <td class="center">{{ r.points_for_result }}</td>
                <td>{{ r.competitor }}</td>
                <td>{% with r.guessers as guessers %}{% if guessers %}{{ guessers|join:", " }}{% else %}------{% endif %}{% endwith %}
            </tr>
{% endfor %}
        </tbody>
    </table>
    {% with result_list.0.entered_by.username as entered_by %}
    {% if entered_by %}<div class="cbnewspubdate">[results kindly entered by {{ entered_by }}]</div>{% endif %}
    {% endwith %}
{% else %}
    No results found.
{% endif %}
</div>

<div  class="fantasy-form-container">
    {% if is_admin or not event.result_locked %}
    <a href="{% url fantasy-result-edit event.pk %}">Edit {{ series.event_label|lower }} results</a><br />
    {% endif %}
    {% if is_admin %}
        <a href="{% url fantasy-series-email series.pk %}">Email guessers in this Series</a><br />
    {% endif %}
</div>

{% if bad_guess_list %}
<h2>{% if result_list %}Out of the points{% else %}Guesses{% endif %}</h2>
<div id="result-list-container" class="fantasy-list-container">
    <table id="guesser-list-table" class="fantasy-list-table">
        <thead>
            <tr>
                <th>Place</th>
                <th>{{ series.competitor_label }}</th>
                <th>Picked By</th>
            </tr>
        </thead>
        <tbody>
{% for g in bad_guess_list %}
            <tr>
                <td class="center">{{ g.result }}</td>
                <td>{{ g.competitor }}</td>
                <td>{% with g.guessers as guessers %}{% if guessers %}{{ guessers|join:", " }}{% else %}------{% endif %}{% endwith %}
            </tr>
{% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<h2>Fantasy Points awarded for this {{ series.event_label|capfirst }}</h2>
{% if event_points_list and not event.result_locked %}(pending Series administrator approval){% endif %}
<div id="result-list-container" class="fantasy-list-container">
{% if event_points_list %}
    <table id="event-points-list-table" class="fantasy-list-table">
        <thead>
            <tr>
                <th>Player</th>
                <th>Points</th>
            </tr>
        </thead>
        <tbody>
{% for r in event_points_list %}
            <tr>
                <td>{{ r.name }}{% if r.late %}&nbsp;*{% endif %}</td>
                <td class="center">{{ r.points }}</td>
            </tr>
{% endfor %}
        </tbody>
    </table>
    {% if late_guesses %}
    <p>*&nbsp;<span class="late-entry">{{ series.late_entry_footnote }}</span></p>
    {% endif %}
{% endif %}
</div>

{% if is_admin and not result_list %}<br /><a href="{% url fantasy-event-delete event.pk %}">Delete {{ series.event_label|lower }}</a>{% endif %}
{% endblock %}

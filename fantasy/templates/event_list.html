{% extends "fantasy-series.html" %}
{% load user_time %}

{% block fantasy-main %}
{{ block.super }}
{% if next_event %}
<div>
<h2>Coming Up Next: <a href="{{ next_event.get_absolute_url }}">{{ next_event }}</a></h2>
{% if not next_guesses %}
<div class="alert">ALERT: You have no picks for this {{ series.event_label|lower }}!</div>
{% else %}
<div class="picks-entered">My picks: {{ next_guesses|join:", " }}.</div>
{% endif %}
<p>
Guess deadline in {{ next_event.guess_deadline|timeuntil }} {% with user|user_time:next_event.guess_deadline as cutoff %}
                ({{ cutoff|date:"D F d" }}, {{ cutoff|time:"f a" }}
                {% firstof user.get_profile.timezone "UTC" %})
                {% endwith %}
</p>
</div>
<hr />
{% endif %}
<div class="section-header">
    <div class="section-title">{{ series }}</div>
    {% if series.description %}<div class="section-tagline">{{ series.description }}</div>{% endif %}
</div>
<hr />
<div class="fantasy-form-help">
Click on a {{ series.event_label|lower }} to enter your picks or see results.<br />
</div>
{% if event_list %}
<div id="event-list-container" class="fantasy-list-container">
    <table id="event-list-table" class="fantasy-list-table">
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>{{ series.event_label }}</th>
                <th>My Guess{{ series.num_guesses|pluralize:",es" }}</th>
                <th>Start</th>
                <th>Guess Cutoff</th>
                <th class="nobg">&nbsp;</th>
            </tr>
        </thead>
        <tbody>
{% for r in event_list %}
            <tr class="{{ r.row_class }}">
                <td>{{ forloop.counter }}.</td>
                <td><a href="{{ r.event.get_absolute_url }}">{{ r.event }}</a><br />{{ r.event.description }}</td>
                <td>{% if r.guesses %}{{ r.guesses|join:"<br />" }}{% else %}?{% endif %}</td>
                <td>{{ r.event.start_date|date:"D F d" }}<br />{{ r.event.start_time|time:"f a" }} UTC</td>
                {% with user|user_time:r.event.guess_deadline as cutoff %}
                <td>{{ cutoff|date:"D F d" }}<br />{{ cutoff|time:"f a" }}<br />
                {% firstof user.get_profile.timezone "UTC" %}</td>
                {% endwith %}
                <td class="nobg">{% if is_admin %}<a href="{% url fantasy-event-edit r.event.pk %}">Edit {{ series.event_label|lower }}</a>{% endif %}</td>
            </tr>
{% endfor %}
        </tbody>
    </table>
</div>
{% else %}
No {{ series.event_label|lower }}s found.<br />
{% endif %}
{% if is_admin %}
<a href="{% url fantasy-event-add series.pk %}">Add {{ series.event_label }} to Series</a><br />
<a href="{% url fantasy-competitor-list series.pk %}">{{ series.competitor_label }} List</a><br />
<a href="{% url fantasy-team-list series.pk %}">Team List</a><br />
<a href="{% url fantasy-series-edit series.pk %}">Edit this Series</a><br />
<a href="{% url fantasy-series-email series.pk %}">Email guessers in this Series</a>
{% endif %}
{% endblock %}

{% extends "fantasy-series.html" %}
{% load humanize %}

{% block javascript %}
{{ block.super }}
<script src="{{ MEDIA_URL }}js/form_scripts/event_guess.js" type="text/javascript" charset="utf-8"></script>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
.yui-b .yui-g {width:100%;}
</style>
{% endblock %}

{% block fantasy-main %}
<div class="section-header">
    <div class="section-title">{{ event }} - <a href="{{ series.get_absolute_url }}">{{ series }}</a></div>
    {% if event.description %}<div class="section-tagline">{{ event.description }}</div>{% endif %}
</div>
{% if user.is_authenticated %}
{% if not event.guess_deadline_elapsed %}
<div class="fantasy-guess-deadline">
Guess Deadline: {{ event.guess_cutoff|date:"D F d" }} {{ event.guess_cutoff|time:"f a" }} UTC
</div>
{% endif %}
<div class="fantasy-form-help">
Pick {{ series.num_guesses|apnumber }} {{ series.competitor_label|lower }}{{ series.num_guesses|pluralize:",s" }} you think will excel in this {{ series.event_label|lower }}.<br />
You may also select {{ series.competitor_label|lower }}{{ series.num_guesses|pluralize:",s" }} by choosing a team.
{% if add_competitor_ok %}
{% endif %}
</div>
{% if late_entry %}
<div class="late-entry">
Since you are picking {{ series.competitor_label }}{{ series.num_guesses|pluralize:",s" }} after the deadline,
once you submit your picks you will not be able to change them. Pick carefully!
</div>
{% endif %}
<div class="yui-g" id="event-guess-container">
  <div class="yui-u first">
    <div class="fantasy-form-container">
    {% if formset %}
      <form name="guess-form" method="POST" action="">{% csrf_token %}
        {{ formset.management_form }}
        {% for error in formset.non_form_errors %}
        {{ error }}
        {% endfor %}
        <table id="event-guess-table" class="fantasy-select-table">
            <thead>
                <th>{{ series.competitor_label }}</th>
            </thead>
            <tbody>
            {% for form in formset.forms %}
            <tr>
                <td>{{ form.competitor }} {{ form.competitor.errors }}</td>
                {% if form.non_field_errors %}<td> {{ form.non_field_errors }}</td>{% endif %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <input type="submit" name="guess" value="Submit Picks" />
      </form>
    {% endif %}
    </div>
  </div>
  <div class="yui-u">
    <div class="fantasy-form-container">
    {% if team_form %}
      <form name="team-form" method="POST" action="">{% csrf_token %}
        <table id="event-team-guess-table" class="fantasy-select-table">
            <thead>
                <th>Team</th>
            </thead>
            <tbody>
            <tr>
                <td>{{ team_form.team }}</td>
            </tr>
            </tbody>
        </table>
      </form>
    {% endif %}
    </div>
  </div>
</div>

{% if add_competitor_ok %}
<div class="fantasy-form-help">
Or add a new {{ series.competitor_label }} by entering the name below and clicking on "Add {{ series.competitor_label }}".
</div>
<div class="fantasy-form-container">
  <form name="new-competitor-form" method="POST" action="">{% csrf_token %}
  <table class="fantasy-select-table">
    <thead>
      <th>New Driver</th>
    </thead>
    <tbody>
      <tr><td>{{ competitor_form.name }}</td></tr>
    </tbody>
  </table>
    
  <input type="submit" name="guess" value="Add {{ series.competitor_label }}" />
  </form>
</div>
{% endif %}
    
{% else %}
<div class="fantasy-form-container">
Sign up to pick your favorite {{ series.competitor_label }}s for this {{ series.event_label }}.
</div>
{% endif %}
<div  class="fantasy-list-container">
    {% if guessers %}
    <h2>Players with picks in this {{ series.event_label }}</h2>
    <ul>
    {% for scup in guessers %}
    <li>{{ scup.user.username }}</li>
    {% endfor %}
    </ul>
    {% endif %}
{% if is_admin %}
    <br />
    <a href="{% url fantasy-event-edit event.pk %}">Edit {{ series.event_label|lower }}</a><br />
{% endif %}
    {% if is_admin or event.start_time_elapsed %}
    <br />
<a href="{% url fantasy-result-edit event.pk %}">Edit {{ series.event_label|lower }} results</a><br />
    {% endif %}
</div>
{% endblock %}
